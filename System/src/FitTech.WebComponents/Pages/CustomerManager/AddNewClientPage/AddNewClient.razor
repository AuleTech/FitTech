@page "/usermanager/add"
@inject UserService UserService
@using FitTech.WebComponents.Pages.CustomerManager.CustomerManagerModels


<div class="w-full max-w-md px-4">
    <!-- Barra de pasos -->
    <div class="flex items-center justify-between mb-6 relative">
        <!-- Línea de fondo -->
        <div class="absolute top-1/2 left-0 right-0 h-1 bg-gray-300 dark:bg-gray-600 -z-10"></div>

        @for (int step = 1; step <= TotalSteps; step++)
        {
            var isActive = step == CurrentStep;
            var stepClasses = isActive
                ? "w-10 h-10 flex items-center justify-center rounded-full border-4 text-green-600 text-green-600 bg-white dark:bg-gray-800 font-bold"
                : "w-10 h-10 flex items-center justify-center rounded-full border-4 border-gray-400 text-gray-400 bg-white dark:bg-gray-800 font-bold";

            <div class="flex flex-col items-center z-10">
                <div class="@stepClasses">@step</div>
            </div>
        }
    </div>

    <!-- Contenido según el paso -->
    <div class="rounded-md border border-gray-300 bg-white p-6 shadow-md dark:border-gray-700 dark:bg-gray-800 dark:shadow-none">
        @if (CurrentStep == 1)
        {
            <p class="mb-4 text-gray-700 dark:text-gray-200">Paso 1: Información personal</p>
            <PersonalInformationForm Model="NewClient" ></PersonalInformationForm>
            <div class="mt-6 flex justify-between">
            <button @onclick="NextStep" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700" disabled="@(CurrentStep == TotalSteps)">Siguiente</button>
            </div>
        }
        else if (CurrentStep == 2)
        {
            <p class="mb-4 text-gray-700 dark:text-gray-200">Paso 2: Detalles del entrenamiento</p>
            <DetailForm Model="NewClient"></DetailForm>
            <div class="mt-6 flex justify-between">
                <button @onclick="PreviousStep" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-white rounded" disabled="@(CurrentStep == 1)">Anterior</button>
                <button @onclick="NextStep" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700" disabled="@(CurrentStep == TotalSteps)">Siguiente</button>
            </div>
        }
        else if (CurrentStep == 3)
        {
            <p class="mb-4 text-gray-700 dark:text-gray-200">Paso 3: Confirmación</p>
            <ConfirmDataForm Model="NewClient"></ConfirmDataForm>
            <div class="mt-6 flex justify-between">
                <button @onclick="PreviousStep" class="px-4 py-2 bg-gray-200 dark:bg-gray-600 text-gray-800 dark:text-white rounded" disabled="@(CurrentStep == 1)">Anterior</button>
                <button class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700" @onclick="AddNClient">Finalizar</button>
            </div>
        }
    </div>
</div>


@code {
    
    private NewClientModel NewClient = new(); // Modelo compartido
    
    private int CurrentStep = 1;

    private readonly int TotalSteps = 3;

    private void NextStep()
    {
        if (CurrentStep < TotalSteps)
            CurrentStep++;
    }

    private void PreviousStep()
    {
        if (CurrentStep > 1)
            CurrentStep--;
    }

    public async Task AddNClient()
    {
        var response = await UserService.AddNewClientAsync(NewClient);

    }

}